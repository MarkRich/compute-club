version: "3.8"
services:
  lmgym_train:
    build:
      context: .
      dockerfile: lmgym_train/Dockerfile
      args:
          - USER_NAME=trainer
          - USER_UID=1000
          - USER_GID=1000
    ports:
      - "127.0.0.1:8889:8888"
    volumes:
      # - ./:/home/trainer/project
      - ./:/home/trainer/project
      - type: bind
        source: ./lmgym_train/train/explorations/lmgym/
        target: /home/trainer/project/train/explorations/lmgym/
    command: ["/bin/bash", "/home/trainer/project/lmgym_train/train/explorations/lmgym/clm_models/experiments/hh/hh_demo.sh"]
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]
    environment: 
      HUGGINGFACE_TOKEN: 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
      WANDB_AUTH_TOKEN: 0691b022eeb0c6fa947d23ea3c355684d11310af
    #env_file:
    #  - .env