version: "3.9"
services:
  jupyter:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        - USER_NAME=jupyter
        - USER_UID=1000
        - USER_GID=1000
    image: nvidia/cuda:11.7.1-runtime-ubuntu20.04
    ports:
      - "127.0.0.1:8888:8888"
    volumes:
      - ../:/home/jupyter/project/chai_research
    entrypoint: [
      "jupyter", "lab",
      "--ip", "0.0.0.0",
      "--port", "8888",
      "--no-browser"
    ]
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]
